<html><head>
<title>County stats</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <style>
   .loading-label {
  background-color: transparent;
  border: transparent;
  box-shadow: none;
  font-size: 32px;
  text-align: center;
  }
  </style>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-161411893-1"></script>
</head>
<body>
<div id="totalcases" style="width:100%;height:40%;"></div>
<center><strong>The closer the positive cases line is to the total tested line, the greater the potential for missed positive tests.</strong></center>
<hr>
<p><div id="plot" style="width:100%;height:40%;"></div></p>

<script language="javascript">

	fipsId = window.location.search.substring(1);
	var xhr = new XMLHttpRequest();
	xhr.open('GET', "https://coronadatascraper.com/timeseries-byLocation.json", true);
	xhr.responseType = 'json';
	var dateArr = [];
	var casesArr = [];
	var deathsArr = [];
	var newCasesDates = [];
	var newCasesArr = [];
	var totalCasesArr = [];
	var testedArr = [];
	var totalTestedArr = [];
	xhr.onload = function()
	{
	  var status = xhr.status;
	  if (status === 200)
	  {
		var i = 0;
		countycases = xhr.response;
		var countyName = "";
		for (x in countycases)
		{
			//console.log(countycases[x].featureId);
			if (typeof countycases[x].featureId == "string" && countycases[x].featureId.substring(5) == fipsId)
			{
				countyName = countycases[x].county;
				for (date in countycases[x].dates)
				{
					dateArr.push(date);
					casesArr.push(countycases[x].dates[date].cases);
					testedArr.push(countycases[x].dates[date].tested);
				}
			}
		}
		var startAdding = false;
		for (i = 1; i < dateArr.length; i++)
		{
			if (casesArr[i] - casesArr[i-1] > 0)
			{
				startAdding = true;
			}
			if (startAdding)
			{
				newCasesDates.push(dateArr[i]);
				newCasesArr.push(casesArr[i] - casesArr[i-1]);
				totalCasesArr.push(casesArr[i]);
				totalTestedArr.push(testedArr[i]);
			}
		}
		var plot = document.getElementById('plot');
		Plotly.newPlot( plot, [{
		x: newCasesDates,
		y: newCasesArr ,
		type: "bar",
		name: "New Cases" }],
		{title: countyName + " daily reported new cases",  margin: {t:30}}
		);
		var totalCasesPlot = document.getElementById('totalcases');
		Plotly.newPlot( totalCasesPlot, [{
		x: newCasesDates,
		y: totalCasesArr ,
		type: "scatter",
		fill: "tozeroy",
		name: "Positive cases"}, 
		{
		x: newCasesDates,
		y: totalTestedArr,
		type: "scatter",
		fill: 'tonexty',
		name: "Total tested"}],
		{title: countyName + " total cases",  margin: {t:30}}
		);
	  }
	};
	xhr.send();
	

</script>
</body>